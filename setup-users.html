<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RADIUS - Setup Initial Users</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen p-8">
    <div class="max-w-2xl mx-auto">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
            <h1 class="text-2xl font-bold text-gray-900 dark:text-white mb-6">
                RADIUS - Setup Initial Users
            </h1>
            
            <div id="status" class="mb-4 p-4 rounded-md hidden">
                <!-- Status messages will appear here -->
            </div>
            
            <button id="setupBtn" onclick="setupUsers()" 
                    class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                Create Initial Users
            </button>
            
            <div id="results" class="mt-6 space-y-4 hidden">
                <!-- Results will appear here -->
            </div>
        </div>
    </div>

    <script>
        // Fixed Supabase client initialization
        const supabaseClient = window.supabase.createClient(
            'https://pvjdsfhhcugnrzmibhab.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB2amRzZmhoY3VnbnJ6bWliaGFiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3MDQwNjEsImV4cCI6MjA2OTI4MDA2MX0.LXgde3rzdPLmfycDQW2Rf1nJ9qKMUBr2J6Yh1ZGp3Ic'
        );

        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `mb-4 p-4 rounded-md ${
                type === 'success' ? 'bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100' :
                type === 'error' ? 'bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100' :
                'bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100'
            }`;
            statusDiv.textContent = message;
            statusDiv.classList.remove('hidden');
        }

        async function setupUsers() {
            const setupBtn = document.getElementById('setupBtn');
            const resultsDiv = document.getElementById('results');
            
            setupBtn.disabled = true;
            setupBtn.textContent = 'Creating users...';
            
            try {
                // Sign out any existing session first
                await supabaseClient.auth.signOut();
                
                showStatus('Creating admin user...', 'info');
                
                // Create admin user
                const { data: adminData, error: adminError } = await supabaseClient.auth.signUp({
                    email: 'trip.ochenski@valleycreek.org',
                    password: 'AdminPass123!',
                    options: {
                        data: {
                            name: 'Trip Ochenski'
                        }
                    }
                });

                if (adminError) {
                    console.error('Admin error:', adminError);
                    throw adminError;
                }

                showStatus('Creating viewer user...', 'info');
                
                // Create viewer user  
                const { data: viewerData, error: viewerError } = await supabaseClient.auth.signUp({
                    email: 'tripochenski@gmail.com',
                    password: 'ViewerPass123!',
                    options: {
                        data: {
                            name: 'Test Viewer'
                        }
                    }
                });

                if (viewerError) {
                    console.error('Viewer error:', viewerError);
                    throw viewerError;
                }

                // Show results
                showStatus('Users created successfully!', 'success');
                
                resultsDiv.innerHTML = `
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Created Users:</h3>
                        
                        <div class="bg-green-50 dark:bg-green-900 p-4 rounded-md">
                            <h4 class="font-medium text-green-800 dark:text-green-200">ACPD Admin User</h4>
                            <p class="text-green-700 dark:text-green-300">Email: trip.ochenski@valleycreek.org</p>
                            <p class="text-green-700 dark:text-green-300">Password: AdminPass123!</p>
                            <p class="text-green-700 dark:text-green-300">User ID: ${adminData.user?.id || 'Check console'}</p>
                        </div>
                        
                        <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-md">
                            <h4 class="font-medium text-blue-800 dark:text-blue-200">Viewer User</h4>
                            <p class="text-blue-700 dark:text-blue-300">Email: viewer@valleycreek.org</p>
                            <p class="text-blue-700 dark:text-blue-300">Password: ViewerPass123!</p>
                            <p class="text-blue-700 dark:text-blue-300">User ID: ${viewerData.user?.id || 'Check console'}</p>
                        </div>
                        
                        <div class="bg-yellow-50 dark:bg-yellow-900 p-4 rounded-md">
                            <h4 class="font-medium text-yellow-800 dark:text-yellow-200">Next Steps</h4>
                            <ol class="list-decimal list-inside text-yellow-700 dark:text-yellow-300 space-y-2">
                                <li>Check your email for confirmation links (both accounts)</li>
                                <li>Click the confirmation links to verify emails</li>
                                <li>Run this SQL in Supabase to set user roles:</li>
                            </ol>
                            <div class="mt-3 p-3 bg-gray-800 rounded text-green-400 text-sm font-mono overflow-x-auto">
INSERT INTO users (id, email, name, role) VALUES<br>
('${adminData.user?.id}', 'trip.ochenski@valleycreek.org', 'Trip Ochenski', 'ACPD'),<br>
('${viewerData.user?.id}', 'viewer@valleycreek.org', 'Test Viewer', 'Viewer')<br>
ON CONFLICT (email) DO UPDATE SET<br>
  name = EXCLUDED.name,<br>
  role = EXCLUDED.role;
                            </div>
                        </div>
                    </div>
                `;
                resultsDiv.classList.remove('hidden');

                console.log('Admin user created:', adminData);
                console.log('Viewer user created:', viewerData);

            } catch (error) {
                showStatus(`Error creating users: ${error.message}`, 'error');
                console.error('Setup error:', error);
            } finally {
                setupBtn.disabled = false;
                setupBtn.textContent = 'Create Initial Users';
            }
        }

        // Show initial instructions
        document.addEventListener('DOMContentLoaded', () => {
            showStatus('Ready to create initial RADIUS users. Click the button to start.', 'info');
        });
    </script>
</body>
</html>
